global allocs


probe process("/lib/x86_64-linux-gnu/libc-*.so").function("malloc").return {
    allocs[$return] = sprint_merged_stack()
}

probe process("/lib/x86_64-linux-gnu/libc-*.so").function("free").return {
    delete allocs[$mem]
}

probe timer.s($1) {
    foreach (ptr in allocs) {
        println(allocs[ptr])
    }
    exit()
}
